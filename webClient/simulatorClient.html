<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<meta charset="UTF-8">
<title>Vehicle Simulator Web Interface!</title>
</head>



<body>

<p><canvas id="displayCanvas" width="500", height="500"></canvas></p>

<p>
Pick a vehicle to operate:
<select id="vehiclePicker" name="vehicles"></select>
</p>
<p>
Steer the vehicle:
<input id="steeringSlider" type="range" min="-1" max="1" value="0" step="1"/>
</p>
<p>
Set speed
<input id="speedSlider" type="range" min="0" max="5" value="0"/>
</p>
<p>
<button id="vehicleAddButton" type="button" onmouseup="addVehicle()">add vehicle</button>
</p>
</body>
</html>

<script type='text/javascript'>
var offsetX = 250;
var offsetY = 250;
var carImage = new Image();
carImage.src = "car1.png";
var vehiclePicker = document.getElementById("vehiclePicker");
var steeringSlider = document.getElementById("steeringSlider");
var speedSlider = document.getElementById("speedSlider");
var vehicleAddButton = document.getElementById("vehicleAddButton");

steeringSlider.addEventListener("mouseup", handleOperation);
speedSlider.addEventListener("mouseup", handleOperation);

var vehicles = [];

<!-- Initial configuration of canvas -->
function config() {
	var canvas = document.getElementById("displayCanvas");
	var context = canvas.getContext("2d");
	context.fillStyle = "#ccffff";

}

<!-- Handle changing speed or steering -->
function handleOperation(){
	var operateURLBase = "http://localhost:8000/vehicleoperate?";
	var uid = vehiclePicker.value;
	var rotation = steeringSlider.value;
	var speed = speedSlider.value;
	
	var requestURL = operateURLBase + "uid=" + uid + "&rotation=" + rotation + "&speed=" + speed;
	console.log(requestURL);
	$.get(requestURL);
	
}


function handleUpdate(data, status){
	if(status == "success"){
		var canvas = document.getElementById("displayCanvas");
		var context = canvas.getContext("2d");
		
		context.clearRect(0, 0, canvas.width, canvas.height);
		
		var newVehicles = [];
		
		for(var key in data){
			status = data[key];
			var x = Math.round(parseFloat(status["x"])) + offsetX;
			var y = Math.round(parseFloat(status["y"])) + offsetY;
			
			//console.log(x);
			//console.log(y);
			
			var orientation = parseFloat(status["orientation"]);
			
			context.save();
			//Move to turning axis of image
			var turningAxisX = carImage.width/2;
			var turningAxisY = 3 * carImage.height/4;
			
			context.translate(x, y);
			//context.translate(turningAxisX, turningAxisY);
			//context.rotate(orientation);
			//context.drawImage(carImage, -turningAxisX, -turningAxisY);
			
			
			context.drawImage(carImage, 0, 0);
			context.restore();
			
			newVehicles.push(key);
			
		}
		
		newVehicles = newVehicles.sort();
		
		if(!(newVehicles.toString() === vehicles.toString())){
			vehicles = newVehicles;
			
			vehiclePicker = document.getElementById("vehiclePicker");
			
			// Clear drop down menu and add the new vehicles
			for(i=0 ; i< vehiclePicker.length ; i++){
				vehiclePicker.remove(i);
			}
			for(v in vehicles){
				var option = document.createElement("option");
				option.text = vehicles[v];
				vehiclePicker.add(option);
			}
			
		}
		
		
		
		
	}
}

function addVehicle(){
	var URL = "http://localhost:8000/vehicleadd";
	
	$.get(URL);
	
}

function updateDisplay(){
	var statusURL = "http://localhost:8000/vehiclestatus";
	
	$.get(statusURL, handleUpdate, "json");
	
	
}
window.onload = config;
setInterval(updateDisplay, 100)
</script>